# PostgreSQL

## Типы данных

- INT - (integer) целые числа
- VARCHAR - (character varying) тип для хранения текстовых строк

## SQL Запросы

### Создание таблицы

Запрос на создание таблицы в общем виде выглядит так:

```sql
CREATE TABLE название_таблицы
(название_столбца1 тип_данных , 
 название_столбца2 тип_данных ,
 .............................
 название_столбцаN тип_данных ,
 атрибуты_таблицы
);
```

Пример создания таблицы:

````sql
CREATE TABLE positions 
(
    id	INT PRIMARY KEY,
    title	VARCHAR,
    salary	INT
);

CREATE TABLE persons 
(
    id	INT PRIMARY KEY,
    name	VARCHAR,
    position_id	INT,
    FOREIGN KEY (position_id) REFERENCES positions(id)
);
````

#### Первичный ключ

Может быть составным. Определяет уникальность строки.
Для его создания используются ключевые слова `PRIMARY KEY`.

#### Вторичный ключ

Ссылается на первичный ключ связанной таблицы. Для его Для его 
создания используется конструкция 
`FOREIGN KEY (position_id) REFERENCES positions(id)`, где 
`position_id` - столбец внешнего ключа, а `positions(id)` - название таблицы
и название столбца первичного ключа.

### Редактирование таблицы

1. ALTER TABLE: Основная команда для изменения структуры таблицы.
2. ADD COLUMN: Добавление нового столбца в таблицу.
3. DROP COLUMN: Удаление столбца из таблицы.
4. ALTER COLUMN: Изменение типа данных или других свойств столбца.
5. RENAME COLUMN: Переименование столбца.
6. RENAME TO: Переименование таблицы.

####  Примеры запросов

1. Добавление столбца

 ````sql
 ALTER TABLE positions
 ADD COLUMN award VARCHAR(100);
 ````
2. Переименование столбца

````sql
ALTER TABLE positions
RENAME COLUMN award TO bonus;
````

3. Изменение типа данных столбца

````sql
ALTER TABLE positions
ALTER COLUMN bonus TYPE INT USING bonus::INT;
````

4. Переименование таблицы

````sql
ALTER TABLE positions
RENAME TO job_titles;
````

5. Удаление столбца

````sql
ALTER TABLE job_titles
DROP COLUMN bonus;
````


### Добавление записи в таблицу

Пример запроса:

````sql
INSERT INTO positions (id, title, salary) VALUES
	('1', 'Программист', '1500'),
	('2', 'Юрист', '700'),
	('3', 'HR', '700'),
	('4', 'Дизайнер', '700'),
	('5', 'Маркетолог', '500'),
	('6', 'Data Engineer', '3000');

INSERT INTO persons (id, name, position_id) VALUES
    ('1', 'Владимир', '4'),
    ('2', 'Алёна', '1'),
    ('3', 'Евгений', '5'),
    ('4', 'Артём', '2'),
    ('5', 'Борис', '4'),
    ('6', 'Татьяна', '3');
````

Расшифровка `ВСТАВЬ В (таблицу)  positions в столбцы( id, title, salary) ЗНАЧЕНИЯ (...)`

### Обновление записи в таблице

````sql
UPDATE positions
SET title = 'Халтурщик', salary = '50'
WHERE id = 7;
````

### Удаление записи в таблице

````sql
DELETE FROM positions
WHERE id = 7;
````

### Выборка данных (SELECT)

Общий вид:
````sql
SELECT название_столбца1, название_столбца2, название_столбцаN 
FROM название_таблицы;
````

Пример:
````sql
SELECT * 
FROM positions;
````

Чтобы выбрать все столбцы:
````sql
SELECT * 
FROM название_таблицы;
````

#### Фильтрация выборки (WHERE)

````sql
SELECT title
FROM positions
WHERE salary > 1000;
````

##### Операторы сравнения:
- `=` - сравнение на равенство
- `<>` - сравнение на неравенство
- `!=` - сравнение на неравенство
- `<` - меньше чем
- `>` - больше чем
- `<=` - меньше чем или равно
- `>=` - больше чем или равно

Условие `LIKE` или `NOT LIKE`  позволяет использовать подстановочные символы (метасимволы) в операторе `WHERE`.
Пример:
````sql
SELECT title, salary
FROM positions
WHERE title LIKE '%Data%';
````

#### Уникальные значения (DISTINCT)
`DISTINCT` — это ключевое слово, которое используется для удаления 
дублирующихся строк из результата запроса.

Пример запроса:
````sql
SELECT DISTINCT(salary)
FROM positions;
````

##### Ограничения и особенности:

- `DISTINCT` применяется ко всему результату строки: Когда используется `DISTINCT`, он 
проверяет уникальность всей строки, если указывается несколько столбцов.

- `DISTINCT` и `NULL`: В SQL `NULL` считается уникальным значением, 
поэтому, если в столбце есть несколько NULL значений, DISTINCT оставит только одно.

- Влияние на производительность: Использование `DISTINCT` 
может замедлить выполнение запроса, особенно на больших наборах данных, 
поскольку требуется дополнительная обработка для удаления дублирующихся строк.


#### Алиасы

Для удобства можно использовать псевдонимы.
````sql
SELECT title, salary AS sal
FROM positions
WHERE title LIKE '%Data%';
````

Ключевое слово AS используется для создания псевдонима. В PostgreSQL можно
использовать проблел без `AS`.

#### Агрегатные функции

- `COUNT()` - для нахождения количества строк в запросе.
- `AVG()` - для нахождения среднего значение.
- `SUM()` - для нахождения суммы значений.
- `MIN()` - для нахождения наименьшего значения.
- `MAX()` - для нахождения наибольшего значения.

## Оптимизация

- Не использовать `*` в `SELECT` запросах
- Ограничение выборки в `SELECT` запрос с помощью оператора `LIMIT`
- Не использовать `DISTINCT` на больших выборках























